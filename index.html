<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bodega¬†Crawl¬†K√∏benhavn</title>

    <!-- Leaflet CSS (integrity fjernet for at undg√• blokering i sandbox) -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
      :root {
        --primary: #d4343a;
        --primary-dark: #b8252a;
        --primary-light: #e66b70;
        --secondary: #f4a261;
        --accent: #2a9d8f;
        --background: #f8f9fa;
        --surface: #ffffff;
        --surface-variant: #f1f3f4;
        --text-primary: #1a1a1a;
        --text-secondary: #5f6368;
        --text-tertiary: #9aa0a6;
        --border: #e8eaed;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15), 0 4px 10px rgba(0, 0, 0, 0.1);
        --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: var(--background);
        color: var(--text-primary);
        line-height: 1.6;
      }

      .header {
        background: var(--gradient);
        color: white;
        padding: 2rem 1rem;
        text-align: center;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="20" cy="20" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="80" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="70" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
        background-size: 100px 100px;
        opacity: 0.3;
      }

      h1 {
        margin: 0;
        font-size: 2.2rem;
        font-weight: 700;
        position: relative;
        z-index: 1;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        margin: 0.5rem 0 0 0;
        font-size: 1.1rem;
        opacity: 0.9;
        font-weight: 400;
        position: relative;
        z-index: 1;
      }

      h2 {
        margin: 0 0 1.5rem 0;
        color: var(--primary);
        font-size: 1.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      h2::before {
        content: '';
        width: 4px;
        height: 2rem;
        background: var(--gradient);
        border-radius: 2px;
      }

      #map {
        width: 100%;
        height: 60vh;
        min-height: 400px;
        border-radius: 12px;
        box-shadow: var(--shadow-lg);
        margin: 2rem 0;
        overflow: hidden;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      section {
        padding: 2rem 1rem;
        margin-bottom: 1rem;
      }

      .section-card {
        background: var(--surface);
        border-radius: 16px;
        box-shadow: var(--shadow);
        overflow: hidden;
        margin-bottom: 2rem;
      }

      .section-content {
        padding: 2rem;
      }

      details {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 0;
        background: var(--surface);
        transition: all 0.3s ease;
        margin-bottom: 1rem;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      details:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      details[open] {
        background: var(--surface-variant);
        box-shadow: var(--shadow);
      }

      summary {
        list-style: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 1rem;
        font-weight: 600;
        padding: 1.5rem;
        background: var(--surface);
        border-radius: 12px;
        transition: all 0.2s ease;
        position: relative;
      }

      summary::-webkit-details-marker {
        display: none;
      }

      summary::after {
        content: "‚ñº";
        font-size: 0.8em;
        color: var(--text-secondary);
        transition: transform 0.2s ease;
        margin-left: auto;
      }

      details[open] summary::after {
        transform: rotate(180deg);
      }

      details.checked summary {
        text-decoration: line-through;
        opacity: 0.6;
        background: var(--surface-variant);
      }

      .place-content {
        padding: 0 1.5rem 1.5rem 1.5rem;
        color: var(--text-secondary);
        line-height: 1.7;
      }

      .place-address {
        font-size: 0.9rem;
        color: var(--text-tertiary);
        font-style: italic;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
      }

      input[type="checkbox"] {
        width: 1.2em;
        height: 1.2em;
        accent-color: var(--primary);
        cursor: pointer;
        transform: scale(1.1);
      }

      /* Score Display */
      #score-display {
        background: var(--gradient);
        color: white;
        padding: 2rem;
        border-radius: 16px;
        text-align: center;
        font-weight: 700;
        font-size: 1.5em;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      #score-display::before {
        content: 'üèÜ';
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 2rem;
        opacity: 0.3;
      }

      .score-text {
        margin: 0;
        font-size: 1rem;
        opacity: 0.9;
        font-weight: 400;
      }

      .score-number {
        font-size: 2.5rem;
        margin: 0.5rem 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* Map Icons */
      .custom-div-icon {
        background: var(--gradient);
        border-radius: 50%;
        color: white;
        font-weight: 700;
        text-align: center;
        line-height: 30px;
        border: 3px solid white;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .custom-div-icon:hover {
        transform: scale(1.1);
      }

      .custom-div-icon.visited {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        opacity: 0.7;
      }

      /* Challenges */
      .challenge {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--surface);
        border-radius: 8px;
        margin-bottom: 0.5rem;
        transition: all 0.2s ease;
        border: 1px solid var(--border);
      }

      .challenge:hover {
        background: var(--surface-variant);
        transform: translateX(4px);
      }

      .challenge.checked {
        text-decoration: line-through;
        opacity: 0.6;
        background: var(--surface-variant);
      }

      .challenge-text {
        font-weight: 500;
        flex: 1;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--border);
        border-radius: 4px;
        overflow: hidden;
        margin: 1rem 0;
      }

      .progress-fill {
        height: 100%;
        background: var(--gradient);
        transition: width 0.3s ease;
        border-radius: 4px;
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 1.8rem;
        }

        .subtitle {
          font-size: 1rem;
        }

        #map {
          height: 50vh;
          margin: 1rem 0;
        }

        .section-content {
          padding: 1.5rem;
        }

        summary {
          padding: 1rem;
        }

        .challenge {
          padding: 0.8rem;
        }

        #score-display {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <h1>Benjamin, Oskar og Henriks bodega crawl</h1>
        <p class="subtitle">En episk rejse gennem K√∏benhavns bedste bodegaer üç∫</p>
      </div>
    </header>

    <div class="container">
      <div id="map"></div>
    </div>

    <div class="container">
      <div class="section-card">
        <div class="section-content">
          <h2>üèõÔ∏è Bodegaer</h2>
          <div id="place-list"></div>
        </div>
      </div>

      <div class="section-card">
        <div class="section-content">
          <h2>üéØ Challenges</h2>
          <div id="score-display">
            <p class="score-text">Din Score</p>
            <div class="score-number">
              <span id="score">0</span> / <span id="total-challenges">12</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>
          <div id="challenge-list"></div>
        </div>
      </div>
    </div>

    <!-- Leaflet JS (integrity & crossorigin fjernet for at sikre indl√¶sning) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- App¬†logic -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        /* ---------- Data ---------- */
        const places = [
          {
            id: 1,
            name: "Galathea¬†Kroen",
            address: "R√•dhusstr√¶de¬†9,¬†1466¬†K√∏benhavn¬†K",
            desc: "Galathea Kroen √•bnede i sin tid med to s√∏m√¶nd fra den ber√∏mte Galathea-ekspedition bag roret. Stedet er fyldt med eksotiske souvenirs ‚Äì fra masker og skind til en hel kano ‚Äì som de hjembragte fra ekspeditionen. I dag str√∏mmer tonerne af jazzmusik ud af h√∏jttalerne p√• vinyl, og j√¶vnligt er der endda live-jazz p√• programmet. Galathea Kroen var i 1960'erne et af stoppene p√• Dirch Passers legendariske 'D√∏dsrute', hvor byens skuespillere og digtere v√¶ltede fra bev√¶rtning til bev√¶rtning ‚Äì her kunne man v√¶re heldig at m√∏de Dirch Passer selv i baren.",
            lat: 55.6766,
            lon: 12.574561,
          },
          {
            id: 2,
            name: "Toga¬†Vinstue",
            address: "Store¬†Kirkestr√¶de¬†3,¬†1073¬†K√∏benhavn¬†K",
            desc: "Toga Vinstue har snart 100-√•rsjubil√¶um og er kendt som 'det politiske kandest√∏beri' ‚Äì et folkeligt m√∏dested for politiske diskussioner. Indretningen er klassisk og upr√¶tenti√∏s, og b√•de unge og gamle m√∏des her over en √∏l for at vende verdenssituationen. Stamg√¶sterne t√¶ller ungdomspolitikere, journalister og garvede politikere, og ofte st√•r en kendt politiker selv bag baren som g√¶stebartender. Om dagen serveres der traditionelle danske frokostretter, mens aftenen byder p√• et stort udvalg af special√∏l ‚Äì og efter kl. 16 m√• man endda t√¶nde en cigaret, som i de gode gamle dage.",
            lat: 55.678769,
            lon: 12.580237,
          },
          {
            id: 3,
            name: "Bo‚ÄëBi¬†Bar",
            address: "Klareboderne¬†14,¬†1115¬†K√∏benhavn¬†K",
            desc: `Bo-Bi Bars klassiske ovale skilt pryder facaden i Klareboderne. Bo-Bi Bar er en af byens mindste, men mest ikoniske bodegas. If√∏lge sagnet kom en s√∏mand i land i 1917, k√∏bte K√∏benhavns allerf√∏rste bardisk og grundlagde Bo-Bi Bar. Siden F√∏rste Verdenskrig har dette lille sted tiltrukket et bredt publikum ‚Äì alt fra kunstnere og journalister til embedsm√¶nd og 9-til-5-folk har lagt vejen forbi. Indretningen st√•r n√¶sten ur√∏rt med r√∏dt tapet og r√∏de lamper, som de s√• ud i begyndelsen af forrige √•rhundrede. √òl drikkes direkte af flasken, og i det lille r√∏gfyldte lokale kommer man nemt i snak med sidemanden i baren .`,
            lat: 55.680742,
            lon: 12.578066,
          },
          {
            id: 4,
            name: "Roseng√•rdens¬†Bodega",
            address: "Roseng√•rden¬†11,¬†1174¬†K√∏benhavn¬†K",
            desc: "Roseng√•rdens Bodega ligner ved f√∏rste √∏jekast en ganske almindelig brun k√¶lderbodega, men v√¶ggene gemmer p√• dramatisk historie. Under Anden Verdenskrig ‚Äì den 20. april 1944 ‚Äì tr√¶ngte medlemmer af modstandsgruppen BOPA ind og likviderede en dansk stikker med √∏genavnet 'Hestetyven' netop her p√• bodegaen. Skuddene der faldt den dag efterlod skudhuller i v√¶ggen, som man den dag i dag kan f√• √∏je p√•, hvis man kigger godt efter. Historien om likvideringen af Rudolf 'Hestetyven' Christiansen giver stedet en helt s√¶rlig atmosf√¶re og g√∏r Roseng√•rdens Bodega til et levende stykke K√∏benhavner-historie.",
            lat: 55.6819,
            lon: 12.5735,
          },
          {
            id: 5,
            name: "Pal√¶¬†Bar",
            address: "Ny¬†Adelgade¬†5,¬†1104¬†K√∏benhavn¬†K",
            desc: "Pal√¶ Bars intime interi√∏r er udsmykket med gamle emaljeskilte og jazz-memorabilia. Pal√¶ Bar √•bnede i 1984 i lokaler, der har huset v√¶rtshus siden 1930'erne, og stedet har udviklet sig til et samlingspunkt for byens kulturelle sj√¶le. Her kommer k√∏benhavnere i alle aldre og af alle professioner, forenet af k√¶rligheden til den hyggelige atmosf√¶re ‚Äì og til jazzmusikken. V√¶ggene prydes af et v√¶ld af nostalgiske skilte og fotografier, og man fornemmer straks stedets sj√¶l og historie. Pal√¶ Bar er kendt for sin levende jazzkultur: Hver tredje s√∏ndag √•ret rundt er der live jazz, og under Copenhagen Jazz Festival uddeles Pal√¶ Bars Jazzpris p√• 25.000 kr., som siden 1990 √•rligt er givet til en fremragende jazzmusiker. Blandt stamg√¶sterne finder man mange fra kultur- og medieverdenen, og baren har i √•revis v√¶ret et favoritsted for journalister, forfattere og musikere i indre by.",
            lat: 55.681,
            lon: 12.58,
          },
          {
            id: 6,
            name: "Hviids¬†Vinstue",
            address: "Kongens¬†Nytorv¬†19,¬†1050¬†K√∏benhavn¬†K",
            desc: `Den over 300 √•r gamle bar p√• Hviids Vinstue emmer af klassisk k√∏benhavnsk krostemning. Hviids Vinstue har eksisteret uafbrudt siden 1723 og er dermed byens √¶ldste v√¶rtshus p√• samme adresse. Stedet er en legende i K√∏benhavn og byder p√• traditionelt sm√∏rrebr√∏d og kolde √∏l i historiske rammer. Hviids er is√¶r kendt for sin krydrede gl√∏gg, der serveres hvert √•r fra 11. november kl. 11 ‚Äì en juletradition, som trofaste stamkunder valfarter til. Indretningen er klassisk med m√∏rke tr√¶m√∏bler og gamle l√¶dersofaer, og fra vinduet har man udsigt til Kongens Nytorv og Det Kongelige Teater 16. Gennem n√¶sten tre √•rhundreder har Hviids haft bes√∏g af utallige prominente g√¶ster ‚Äì b√•de H.C. Andersen og forfatteren Tove Ditlevsen kom her for at nyde en drink i de hyggelige stuer .`,
            lat: 55.67978,
            lon: 12.58472,
          },
          {
            id: 7,
            name: "Skindbuksen",
            address: "Lille¬†Kongensgade¬†4,¬†1074¬†K√∏benhavn¬†K",
            desc: `Skindbuksen h√∏rer til blandt byens aller√¶ldste bev√¶rtninger og har ligget i Lille Kongensgade siden 1728. Oprindeligt var den en sk√¶nkestue for det fine Grand Caf√© og gik under navnet ‚ÄúCaf√© nr. 4‚Äù efter adressen. Kuskene fra byens hestedroscher yndede at komme her og f√• en dram ‚Äì de bar alle skindovertr√¶ksbukser som en del af uniformen, og i folkemunde begyndte man at kalde stedet ‚ÄúSkindbuksen‚Äù. Navnet bed sig fast og blev det officielt navn i 1930, og bodegaen har stort set heddet det lige siden. Udover den gode, gamle danske menu (bl.a. den ber√∏mte skipperlabskovs) har Skindbuksen ogs√• haft sine farverige stamg√¶ster. Blandt andet kom digteren Jens August Schade j√¶vnligt her i 1970‚Äôerne for at nyde stedets stemning og selskab. Med sin n√¶sten 300-√•rige historie, klassiske atmosf√¶re og st√¶rke fort√¶llinger er Skindbuksen et perfekt sidste stop p√• ruten ‚Äì et sted hvor K√∏benhavns fortid stadig kan m√¶rkes i v√¶ggene.`,
            lat: 55.6793,
            lon: 12.5828,
          },
        ];

        const challenges = [
          { id: "ch1", text: "Bund en √∏l" },
          { id: "ch2", text: "V√¶r en god wingman for Oskar" },
          { id: "ch3", text: "Snak med en du ikke kender" },
          { id: "ch4", text: "Stj√¶l noget (sm√•t & sjovt)" },
          { id: "ch5", text: "F√• bartenderen til at fort√¶lle en vits" },
          { id: "ch6", text: "F√• taget en selfie med en fremmed" },
          { id: "ch7", text: "Dans i mindst 10 sekunder uden musik" },
          { id: "ch8", text: "Byt et stykke t√∏j med en" },
          {
            id: "ch9",
            text: "Syng h√∏jt med p√• en sang, du ikke kender teksten til",
          },
          { id: "ch10", text: "Sk√•l med en gruppe mennesker, du ikke kender" },
          {
            id: "ch11",
            text: "Hold en 1-minuts tale om et komplet tilf√¶ldigt emne",
          },
          { id: "ch12", text: "Skriv et digt om bartenderen og l√¶s det h√∏jt" },
          {
            id: "ch13",
            text: 'Udfordr en fremmed til en "sten-saks-papir" dyst.',
          },
          {
            id: "ch14",
            text: "Start en f√¶llessang blandt fremmede mennesker.",
          },
          {
            id: "ch15",
            text: "Bestil en drink der matcher farven p√• t√∏jet hos en fremmed.",
          },
          {
            id: "ch16",
            text: "F√• nogen til at give dig en high-five uden at forklare hvorfor.",
          },
        ];

        /* ---------- Guard: Leaflet indl√¶st? ---------- */
        if (typeof L === "undefined") {
          const warn = document.createElement("p");
          warn.style.color = "var(--accent)";
          warn.style.padding = "1rem";
          warn.textContent =
            "‚ö†Ô∏è¬†Kortet kunne ikke indl√¶ses (Leaflet mangler). Tjek din internetforbindelse eller script‚Äëurl.";
          document.getElementById("map").replaceWith(warn);
          return;
        }

        /* ---------- Kort ---------- */
        const mapCenter = [55.6795, 12.579];
        const map = L.map("map").setView(mapCenter, 15);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "¬©¬†OpenStreetMap",
          maxZoom: 19,
        }).addTo(map);

        const markers = {};
        places.forEach((p) => {
          if (p.lat && p.lon) {
            const icon = L.divIcon({
              className: "custom-div-icon",
              html: `<span>${p.id}</span>`,
              iconSize: [30, 30],
              iconAnchor: [15, 15],
            });
            const marker = L.marker([p.lat, p.lon], { icon: icon }).addTo(map);
            marker.bindPopup(
              `<strong>${p.id}. ${p.name}</strong><br>${p.address}`
            );
            markers[p.id] = marker;
          }
        });

        const routeLayerGroup = L.layerGroup().addTo(map);

        const updateMapState = () => {
          routeLayerGroup.clearLayers();
          const coords = places.map((p) => [p.lat, p.lon]);

          places.forEach((p) => {
            const isVisited = read(lsKey("visited", p.id));
            if (markers[p.id]) {
              markers[p.id].getElement().classList.toggle("visited", isVisited);
            }
          });

          for (let i = 0; i < coords.length - 1; i++) {
            const startVisited = read(lsKey("visited", places[i].id));
            if (!startVisited) {
              const segment = [coords[i], coords[i + 1]];
              L.polyline(segment, {
                color: "#d4343a",
                weight: 4,
                dashArray: "8, 12",
                opacity: 0.8,
                className: "route-line"
              }).addTo(routeLayerGroup);
            }
          }
        };

        /* ---------- LocalStorage helpers ---------- */
        const lsKey = (prefix, id) => `${prefix}-${id}`;
        const read = (k, def = false) =>
          localStorage.getItem(k) === "true" || def;
        const write = (k, val) => localStorage.setItem(k, !!val);

        /* ---------- Place list ---------- */
        const list = document.getElementById("place-list");
        places.forEach((p) => {
          const details = document.createElement("details");
          details.dataset.id = p.id;
          const visited = read(lsKey("visited", p.id));
          if (visited) details.classList.add("checked");

          const summary = document.createElement("summary");
          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.checked = visited;
          cb.addEventListener("change", () => {
            write(lsKey("visited", p.id), cb.checked);
            details.classList.toggle("checked", cb.checked);
            updateMapState();
          });
          summary.appendChild(cb);
          summary.appendChild(document.createTextNode(`${p.id}. ${p.name}`));
          details.appendChild(summary);

          const para = document.createElement("div");
          para.className = "place-content";
          para.innerHTML = `${p.desc}<div class="place-address">${p.address}</div>`;
          details.appendChild(para);

          list.appendChild(details);
        });

        updateMapState();

        /* ---------- Challenges ---------- */
        const chList = document.getElementById("challenge-list");
        const scoreElement = document.getElementById("score");
        const totalChallengesElement =
          document.getElementById("total-challenges");
        const progressFill = document.getElementById("progress-fill");

        // Set total challenges count
        totalChallengesElement.textContent = challenges.length;

        // Function to update score and progress bar
        const updateScore = () => {
          let score = 0;
          challenges.forEach((c) => {
            if (read(lsKey("challenge", c.id))) {
              score++;
            }
          });
          scoreElement.textContent = score;
          
          // Update progress bar
          const percentage = (score / challenges.length) * 100;
          progressFill.style.width = `${percentage}%`;
        };

        // Initial score calculation
        updateScore();

        challenges.forEach((c) => {
          const div = document.createElement("div");
          div.className = "challenge";
          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.checked = read(lsKey("challenge", c.id));
          const label = document.createElement("span");
          label.className = "challenge-text";
          label.textContent = c.text;

          if (cb.checked) div.classList.add("checked");

          cb.addEventListener("change", () => {
            write(lsKey("challenge", c.id), cb.checked);
            div.classList.toggle("checked", cb.checked);
            updateScore(); // Update score when challenge is checked/unchecked
          });

          div.appendChild(cb);
          div.appendChild(label);
          chList.appendChild(div);
        });
      });
    </script>
  </body>
</html>
